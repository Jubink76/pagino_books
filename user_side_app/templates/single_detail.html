{% extends 'base.html' %}
{% load static %}
{% block css_link %} 
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'user/js/sweetAlert.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-zoom@1.7.21/jquery.zoom.min.js"></script>

<style>
	.image-zoom-container {
		display: flex;
		justify-content: center;
		align-items: center;
		overflow: hidden;
	}
	
	#main-image {
		max-width: 100%;
		max-height: 100%;
		object-fit: contain;
		transition: opacity 0.3s ease, transform 0.3s ease-out;
	}
</style>
{% endblock %}

{% block content %}
<main>
	<div class="flex">
  <!-------------------------------Side bar  section ------------------------>
		<div class="w-64 flex-shrink-0 mt-4 mx-4">
			<!-- Categories Section -->
			<div class="bg-yellow-400 p-4 rounded-t-lg">
				<div class="flex items-center">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
					</svg>
					<h2 class="text-lg font-semibold">Categories</h2>
				</div>
			</div>
			
			<div class="bg-white shadow-md">
			{% for category in categories %}
				{% if category.is_available %}
				<a href="{% url 'single_category' category.id %}" class="flex items-center p-4 border-b hover:bg-gray-50">
					<svg class="w-5 h-5 text-gray-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
					</svg>
					<span class="text-gray-700">{{ category.category_name }}</span>
					<svg class="w-4 h-4 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path d="M9 5l7 7-7 7"/>
					</svg>
				</a>
				{% endif %}
			{% endfor %}
			</div>
			<!-- Deal of the day Section -->
			<div class="mt-8">
				<div class="flex items-center justify-between mb-4">
					<h2 class="text-lg font-semibold">Deal of the day</h2>
					<div class="flex space-x-2">
						<button class="p-1 bg-gray-200 rounded-full">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path d="M15 19l-7-7 7-7"/>
							</svg>
						</button>
						<button class="p-1 bg-gray-200 rounded-full">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path d="M9 5l7 7-7 7"/>
							</svg>
						</button>
					</div>
				</div>
				<div class="bg-white rounded-lg shadow-md w-64">
					<div class="relative">
						<img src="{% static '/api/placeholder/240/240' %}" alt="Deal Product" class="w-full h-96 object-cover rounded-t-lg">
						<div class="absolute top-2 right-2 bg-red-500 text-white rounded-full px-2 py-0.5 text-xs">
							49% OFF
						</div>
					</div>
					<div class="p-3">
						<!-- Timer Section -->
						<div class="flex justify-between space-x-2 mb-2">
							<div class="text-center px-1.5 py-0.5 bg-gray-100 rounded">
								<div class="font-semibold text-sm">120</div>
								<div class="text-xs text-gray-600">DAYS</div>
							</div>
							<div class="text-center px-1.5 py-0.5 bg-gray-100 rounded">
								<div class="font-semibold text-sm">20</div>
								<div class="text-xs text-gray-600">HRS</div>
							</div>
							<div class="text-center px-1.5 py-0.5 bg-gray-100 rounded">
								<div class="font-semibold text-sm">36</div>
								<div class="text-xs text-gray-600">MINS</div>
							</div>
							<div class="text-center px-1.5 py-0.5 bg-gray-100 rounded">
								<div class="font-semibold text-sm">60</div>
								<div class="text-xs text-gray-600">SEC</div>
							</div>
						</div>
				
						<!-- Product Title -->
						<h3 class="font-semibold text-sm mb-1">Floral Print Buttoned</h3>
				
						<!-- Star Rating -->
						<div class="flex items-center mb-1">
							<svg class="w-3 h-3 text-yellow-400 fill-current" viewBox="0 0 20 20">
								<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
							</svg>
							<svg class="w-3 h-3 text-yellow-400 fill-current" viewBox="0 0 20 20">
								<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
							</svg>
							<svg class="w-3 h-3 text-yellow-400 fill-current" viewBox="0 0 20 20">
								<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
							</svg>
							<svg class="w-3 h-3 text-yellow-400 fill-current" viewBox="0 0 20 20">
								<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
							</svg>
							<svg class="w-3 h-3 text-gray-300 fill-current" viewBox="0 0 20 20">
								<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
							</svg>
						</div>
				
						<!-- Price -->
						<div class="flex items-center justify-between mb-2">
							<span class="text-blue-600 font-bold text-sm">$600.00</span>
							<span class="text-gray-500 line-through text-xs">$800.00</span>
						</div>
				
						<!-- Buttons -->
						<div class="flex space-x-2">
							<button class="w-8 h-8 bg-yellow-400 text-white p-1.5 rounded">
								<svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
								</svg>
							</button>
							<button class="flex-1 bg-blue-600 text-white py-1.5 px-3 rounded text-sm">ADD TO CART</button>
						</div>
					</div>
				</div>
			</div>
		
			<!-- Filters Section -->
			<div class="mt-8">
				<h2 class="text-lg font-semibold mb-4">Filters</h2>
				<div class="flex flex-wrap gap-2 mb-6">
					<button class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">Language</button>
					<button class="px-4 py-2 bg-blue-600 text-white rounded-md">Authors</button>
					<button class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">Category</button>
					<button class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">Price</button>
				</div>
			</div>
		
			<!-- Special Deals Section -->
			<div class="mt-8">
				<div class="flex items-center justify-between mb-4">
					<h2 class="text-lg font-semibold">Special Deals</h2>
					<div class="flex space-x-2">
						<button class="p-1 bg-gray-200 rounded-full">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path d="M15 19l-7-7 7-7"/>
							</svg>
						</button>
						<button class="p-1 bg-gray-200 rounded-full">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path d="M9 5l7 7-7 7"/>
							</svg>
						</button>
					</div>
				</div>
				<div class="space-y-4">
					<a href="#" class="flex items-center space-x-4 bg-white p-2 rounded-lg shadow-md">
						<img src="{% static '/api/placeholder/120/160' %}" alt="Product" class="w-[120px] h-[160px] object-cover rounded">
						<div>
							<h3 class="font-semibold">Floral Print Shirt</h3>
							<div class="flex items-center">
								<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20">
									<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
								</svg>
								<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20">
									<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
								</svg>
								<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20">
									<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
								</svg>
								<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20">
									<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
								</svg>
								<svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20">
									<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
								</svg>
							</div>
							<span class="text-green-600 font-bold">$450.99</span>
						</div>
					</a>
				</div>
			</div>
		
			<!-- Testimonial -->
			<div class="mt-8 bg-white rounded-lg shadow-md p-6 text-center">
				<img src="{% static '/api/placeholder/100/100' %}" alt="John Doe" class="w-20 h-20 rounded-full mx-auto mb-4">
				<p class="text-gray-600 mb-4">"Vtae sodales aliq uam morbi non sem lacus port mollis. Nunc condime tum metus eud molest sed consectetuer sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat."</p>
				<h3 class="font-semibold">John Doe</h3>
				<p class="text-gray-600 text-sm">Abc Company</p>
				<div class="flex justify-center space-x-2 mt-4">
					<div class="w-2 h-2 rounded-full bg-blue-600"></div>
					<div class="w-2 h-2 rounded-full bg-gray-300"></div>
					<div class="w-2 h-2 rounded-full bg-gray-300"></div>
				</div>
			</div>
			
		</div>
  
		<div class="flex-1">
			<!-- Main Product Section -->
			<div class="p-6">
			  	<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
				<!-- Image Gallery Section -->
					<div id="product-gallery" class="space-y-8">
						<!-- Main Image with Zoom -->
						<div id="owl-single-product" class="flex justify-center">
							{% if images %}
							<div class="single-product-gallery-item">
						  		<div class="image-zoom-container relative overflow-hidden rounded-lg p-4 bg-gray-100" style="width: 500px; height: 400px;">
									<img 
							  			id="main-image"
							  			class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 max-w-full max-h-full object-contain origin-center"
							  			src="{{ images.0.image.url }}"
							  			data-zoom-image="{{ images.0.image.url }}"
							  			alt="{{ book.title }}"
									/>
						  		</div>
							</div>
							{% endif %}
					  	</div>
					  
					  
					  <!-- Thumbnail Gallery -->
					  	<div class="single-product-gallery-thumbs flex flex-wrap justify-center gap-4">
							<div id="product-thumbnails" class="grid grid-cols-4 gap-4">
						 		{% for image in images %}
									<div class="item">
							  			<a class="horizontal-thumb block rounded-md overflow-hidden {% if forloop.first %}active{% endif %} transform hover:scale-105 transition-transform duration-300" 
								 			data-image="{{ image.image.url }}"
								 			href="javascript:void(0);">
											<img 
								  				class="w-20 h-30 object-cover object-center transition-all duration-300 ease-out "
								  				src="{{ image.image.url }}"
								  				alt="{{ book.title }}"
											/>
							  			</a>
									</div>
						 		{% endfor %}
							</div>
						</div>
					</div>
				  
					{% if book %}
						<!-- Product Info Section -->
						<div class="space-y-6">
				 			 <!-- Product Title -->
				  			<div class="relative inline-block">
								<h1 class="text-3xl font-bold text-gray-800">{{ book.book_name }}</h1>
								{% if book.additional_offer_applied %}
									<span class="absolute top-1/2 right-0 transform translate-x-16 -translate-y-8 bg-gradient-to-r from-purple-500 via-pink-400 to-orange-400 text-white px-4 py-2 rounded-full text-sm font-semibold shadow-md transform rotate-45">
										{{ book.applied_offer.offer_name }}
									</span>
								{% endif %}
							</div>																								
		  
				  			<!-- Rating -->
				  			<div class="flex items-center space-x-4">
								<div class="flex items-center">
									{% for i in rating_range %}
										{% if i <= average_rating %}
											<svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
												<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
											</svg>
										{% else %}
											<svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
												<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
											</svg>
										{% endif %}
									{% endfor %}
								</div>
								<span class="ml-2 text-sm text-gray-600">({{ review_count }} reviews)</span>
							</div>							
		  
				 			 <!-- Availability -->
				  			<div class="flex items-center space-x-2">
								<span class="text-gray-700">Availability:</span>
									{% if book.is_available %}
								<span class="text-green-600 font-medium">In Stock</span>
									{% else %}
								<span class="text-red-600 font-medium">Out of Stock</span>
									{% endif %}
				  			</div>
		  
				  			<!-- Description -->
				 			 <p class="text-gray-600">{{ book.description }}</p>
							
							<!---offer if available-->
							{% if book.additional_offer_applied %}
								<span class="mt-4 inline-block bg-gradient-to-r from-pink-500 via-yellow-400 to-red-500 text-black px-8 py-5 rounded-full text-lg font-semibold shadow-lg transform transition-all duration-300 ease-in-out hover:scale-110 hover:shadow-2xl hover:ring-4 hover:ring-pink-300 flex items-center justify-center w-28 h-28 text-center animate-bounce">
									
									{% if book.applied_offer.discount_type == 'percentage' %}
										<span class="block mt-1 text-xl font-bold text-black">
											Save {{ book.applied_offer.discount_value }}% off
										</span>
									{% elif book.applied_offer.discount_type == 'fixed' %}
										<span class="block mt-1 text-xl font-bold text-black">
											Save ₹{{ book.applied_offer.discount_value }} off
										</span>
									{% endif %}
								</span>
							{% endif %}
				  			<!-- Price -->
				  			<div class="flex items-center space-x-4">
								<span class="text-3xl font-bold text-pink-500">₹{{ book.offer_price }}</span>
								<span class="text-xl text-gray-400 line-through">₹{{ book.base_price }}</span>
				  			</div>
							  
				  			<!-- Quantity and Add to Cart -->
				  			<!--<div class="flex items-center space-x-4">
								<div class="flex items-center border rounded-md">
					  				<button class="px-3 py-2 hover:bg-gray-100">-</button>
					  			<input 
									type="text" 
									value="1"
									class="w-16 text-center border-x px-2 py-2"
					  			>
					  			<button class="px-3 py-2 hover:bg-gray-100">+</button>
							</div>-->
							<div class="flex items-center space-x-4">
								<form id="cart-form" class="m-0">
									{% csrf_token %}
									<button type="submit"
										class="add-to-cart-btn px-8 py-3 rounded-md transition flex items-center space-x-2 
										{% if not book.is_available %}
											bg-gradient-to-r from-gray-400 to-gray-600 text-gray-300 cursor-not-allowed
										{% else %}
											bg-blue-600 text-white hover:bg-blue-700
										{% endif %}"
										data-url="{% url 'add_to_cart' book.id %}"
										{% if not book.is_available %} disabled {% endif %}>
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
												d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
										</svg>
										<span>ADD TO CART</span>
									</button>
								</form>
								
								<form id="wishlist-form" class="m-0">
									{% csrf_token %}
									<button type="submit"
										class="add-to-wishlist-btn px-4 py-3 rounded-md transition flex items-center space-x-2 
										{% if not book.is_available %}
											bg-gradient-to-r from-gray-400 to-gray-600 text-gray-300 cursor-not-allowed
										{% else %}
											bg-pink-100 text-pink-600 hover:bg-pink-200
										{% endif %}"
										data-url="{% url 'add_to_whishlist' book.id %}"
										{% if not book.is_available %} disabled {% endif %}>
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
												d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
										</svg>
										<span>ADD TO WISHLIST</span>
									</button>
								</form>
							</div>							
							
				  		</div>
				</div>
				{% endif %}
			</div>		  
			  <!-- Related Products -->
			<div class="p-8">
				<h2 class="text-2xl font-bold mb-6">Related Products</h2>
				<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
				  {% for related_book in related_books %}
					  <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300">
						  <div class="relative aspect-[3/4]">
							<a href="{% url 'single_detail' book.id %}">
							  <img 
								  src="{{ related_book.images.first.image.url }}" 
								  alt="{{ related_book.book_name }}" 
								  class="w-full h-full object-contain"
							  />
							</a>
							  <span class="absolute top-2 right-2 bg-blue-400 text-white px-2 py-1 rounded-full text-sm">NEW</span>
						  </div>
						  <div class="p-4">
							  <h3 class="font-semibold text-lg mb-2">{{ related_book.book_name }}</h3>
							  <p class="text-gray-600 mb-2">{{ related_book.author }}</p>
							  <div class="flex text-yellow-400 mb-2">★★★★☆</div>
							  <div class="flex justify-between items-center">
								  <span class="text-green-600 font-bold">₹{{ related_book.offer_price }}</span>
								  <span class="text-gray-400 line-through">₹{{ related_book.base_price }}</span>                       
							  </div>
						  </div>
					  </div>
				  {% endfor %}
				</div>
			</div>
		</div>
	</div>
</main>
  
{% endblock %}

{% block script %}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		function initImageZoom(container) {
		  const mainImage = container.querySelector('#main-image');
		  const zoomContainer = container.querySelector('.image-zoom-container');
	  
		  // Reset styles for proper positioning
		  zoomContainer.style.position = 'relative';
		  zoomContainer.style.overflow = 'hidden';
		  mainImage.style.transition = 'transform 0.3s ease-out';
		  mainImage.style.transformOrigin = 'center center';
	  
		  // Add event listeners for zoom effect
		  zoomContainer.addEventListener('mousemove', function (e) {
			const rect = zoomContainer.getBoundingClientRect();
			const mouseX = e.clientX - rect.left;
			const mouseY = e.clientY - rect.top;
	  
			const zoomLevel = 2.5; // Adjust zoom level here
			const offsetX = Math.min(
			  Math.max((mouseX / rect.width) * 100, 0),
			  100
			); // Clamp between 0 and 100
			const offsetY = Math.min(
			  Math.max((mouseY / rect.height) * 100, 0),
			  100
			);
	  
			mainImage.style.transform = `
			  scale(${zoomLevel}) 
			  translate(${50 - offsetX}%, ${50 - offsetY}%)
			`;
			mainImage.style.cursor = 'zoom-in';
		  });
	  
		  zoomContainer.addEventListener('mouseleave', function () {
			mainImage.style.transform = 'scale(1) translate(-50%, -50%)';
			mainImage.style.cursor = 'default';
		  });
	  
		  // Ensure image maintains aspect ratio and fits container
		  mainImage.style.maxWidth = '100%';
		  mainImage.style.maxHeight = '100%';
		  mainImage.style.objectFit = 'contain';
		}
	  
		function initThumbnails() {
		  const thumbnails = document.querySelectorAll(
			'.single-product-gallery-thumbs a'
		  );
		  const mainImage = document.getElementById('main-image');
	  
		  thumbnails.forEach((thumbnail) => {
			thumbnail.addEventListener('click', function (e) {
			  e.preventDefault();
			  thumbnails.forEach((t) => t.classList.remove('active'));
			  this.classList.add('active');
	  
			  const newImageSrc = this.getAttribute('data-image');
			  mainImage.style.opacity = 0;
	  
			  setTimeout(() => {
				mainImage.src = newImageSrc;
				mainImage.setAttribute('data-zoom-image', newImageSrc);
				mainImage.style.transform = 'scale(1) translate(-50%, -50%)'; // Reset transform on image change
				mainImage.style.opacity = 1;
			  }, 300);
			});
		  });
		}
	  
		const productGallery = document.getElementById('product-gallery');
		if (productGallery) {
		  initImageZoom(productGallery);
		  initThumbnails();
		}
	  });	  
	  
</script>
{% endblock %}